import { INodeType, INodeTypeDescription } from 'n8n-workflow';

export class JsonInput implements INodeType {
  description: INodeTypeDescription = {
    displayName: 'Json Input',
    name: 'jsonInput',
    group: ['transform'],
    version: 1,
    description: 'A custom node that accepts JSON input',
    defaults: {
      name: 'Json Input',
      color: '#1F8EB2',
    },
    inputs: ['main'],
    outputs: ['main'],
    properties: [
      {
        displayName: 'Content (JSON)',
        name: 'content',
        type: 'json',
        default: '',
        description: 'Input your JSON here',
      },
    ],
    icon: 'data:image/png;base64,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'
  };

  async execute(this: any) {
    const items = this.getInputData();
    const returnData = [];

    const content = this.getNodeParameter('content', 0);

    // Validate and parse JSON
    let parsedContent;
    try {
      if (typeof content === 'string') {
        parsedContent = JSON.parse(content);
      } else {
        parsedContent = content;
      }
    } catch (error) {
      throw new Error(`Invalid JSON provided: ${(error as Error).message}`);
    }

    // If there are input items, merge the JSON content with them
    if (items.length > 0) {
      for (let i = 0; i < items.length; i++) {
        // Merge input data with the provided JSON
        returnData.push({
          json: {
            ...items[i].json,
            ...parsedContent
          }
        });
      }
    } else {
      // If no input items, create new items with the JSON content
      returnData.push({ json: parsedContent });
    }

    return this.prepareOutputData(returnData);
  }
}
